.. note::
    :class: sphx-glr-download-link-note

    Click :ref:`here <sphx_glr_download_auto_examples_sync_sync_test.py>` to download the full example code
.. rst-class:: sphx-glr-example-title

.. _sphx_glr_auto_examples_sync_sync_test.py:


=============
A-V sync test
=============

This example tests synchronization between the screen and the audio playback.

.. note: On Linux (w/NVIDIA), XFCE has been observed to give consistent
         timings, whereas Compiz WMs did not (doubled timings).



.. image:: /auto_examples/sync/images/sphx_glr_sync_test_001.png
    :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none

    exp_name: SyncTest
    date: 2019-01-30 22_36_24.240586
    file: /home/circleci/project/examples/sync/sync_test.py
    participant: s
    session: 0
    2019-01-30 22:36:24,240 - INFO    - Expyfun: Using version 2.0.0.dev0 (requested dev)
    2019-01-30 22:36:24,241 - INFO    - Expyfun: Setting up Pyglet audio
    2019-01-30 22:36:24,275 - INFO    - Expyfun: Setting up screen
    2019-01-30 22:36:24,291 - EXP     - Expyfun: Set screen visibility True
    2019-01-30 22:36:24,355 - INFO    - Expyfun: Initializing dummy triggering mode
    2019-01-30 22:36:24,357 - INFO    - Expyfun: Initialization complete
    2019-01-30 22:36:24,358 - EXP     - Expyfun: Participant: s
    2019-01-30 22:36:24,358 - EXP     - Expyfun: Session: 0
    2019-01-30 22:36:24,360 - EXP     - Expyfun: Loading 200 samples to buffer
    2019-01-30 22:36:24,410 - EXP     - Expyfun: Starting stimuli: flipping screen and playing audio
    2019-01-30 22:36:24,687 - EXP     - Expyfun: Audio stopped and reset.
    2019-01-30 22:36:24,687 - INFO    - Expyfun: Exiting
    2019-01-30 22:36:24,690 - EXP     - Expyfun: Audio stopped and reset.




|


.. code-block:: python

    # Author: Dan McCloy <drmccloy@uw.edu>
    #
    # License: BSD (3-clause)

    import numpy as np

    from expyfun import ExperimentController, building_doc
    from expyfun.visual import Circle
    import expyfun.analyze as ea

    print(__doc__)


    # Fullscreen MUST be used to guarantee flip accuracy!
    with ExperimentController('SyncTest', full_screen=True, noise_db=-np.inf,
                              participant='s', session='0', output_dir=None,
                              suppress_resamp=True, check_rms=None,
                              version='dev') as ec:
        ec.load_buffer(np.r_[0.1, np.zeros(99)])  # RMS == 0.01
        pressed = None
        screenshot = None
        # Make a circle so that the photodiode can be centered on the screen
        circle = Circle(ec, 1, units='deg', fill_color='k', line_color='w')
        while pressed != '8':  # enable a clean quit if required
            ec.set_background_color('white')
            t1 = ec.start_stimulus(start_of_trial=False)  # skip checks
            ec.set_background_color('black')
            t2 = ec.flip()
            diff = round(1000 * (t2 - t1), 2)
            ec.screen_text('IFI (ms): {}'.format(diff), wrap=True)
            circle.draw()
            screenshot = ec.screenshot() if screenshot is None else screenshot
            ec.flip()
            ec.stamp_triggers([2, 4, 8])
            ec.refocus()
            pressed = ec.wait_one_press(0.5)[0] if not building_doc else '8'
            ec.stop()

    ea.plot_screen(screenshot)


.. rst-class:: sphx-glr-timing

   **Total running time of the script:** ( 0 minutes  0.608 seconds)


.. _sphx_glr_download_auto_examples_sync_sync_test.py:


.. only :: html

 .. container:: sphx-glr-footer
    :class: sphx-glr-footer-example



  .. container:: sphx-glr-download

     :download:`Download Python source code: sync_test.py <sync_test.py>`



  .. container:: sphx-glr-download

     :download:`Download Jupyter notebook: sync_test.ipynb <sync_test.ipynb>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.readthedocs.io>`_

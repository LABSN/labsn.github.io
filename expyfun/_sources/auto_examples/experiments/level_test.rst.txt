.. note::
    :class: sphx-glr-download-link-note

    Click :ref:`here <sphx_glr_download_auto_examples_experiments_level_test.py>` to download the full example code
.. rst-class:: sphx-glr-example-title

.. _sphx_glr_auto_examples_experiments_level_test.py:


============================================
Sound level test and visual size calibration
============================================

This example tests the audio level and video size. For audio, it produces an 80
db SPL 1000 Hz tone (note that at 1000 Hz, the frequency weighting for SPL
measurement shouldn't matter). For video, it produces a square that should be
10 degrees visual angle and tells you what the physical width should be in cm.
This of course depends on correct settings for monitor width, resolution, and
distance.



.. image:: /auto_examples/experiments/images/sphx_glr_level_test_001.png
    :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none

    exp_name: LevelTest
    date: 2019-04-15 20_00_54.417330
    file: /home/circleci/project/examples/experiments/level_test.py
    participant: s
    session: 0
    2019-04-15 20:00:54,417 - INFO    - Expyfun: Using version 2.0.0.dev0 (requested dev)
    2019-04-15 20:00:54,417 - INFO    - Expyfun: Setting up Pyglet audio
    2019-04-15 20:00:54,462 - INFO    - Expyfun: Setting up screen
    2019-04-15 20:00:54,477 - EXP     - Expyfun: Set screen visibility True
    2019-04-15 20:00:54,534 - INFO    - Expyfun: Initializing dummy triggering mode
    2019-04-15 20:00:54,536 - INFO    - Expyfun: Initialization complete
    2019-04-15 20:00:54,536 - EXP     - Expyfun: Participant: s
    2019-04-15 20:00:54,536 - EXP     - Expyfun: Session: 0
    2019-04-15 20:00:54,550 - EXP     - Expyfun: Loading 488280 samples to buffer
    2019-04-15 20:00:54,689 - EXP     - Expyfun: Starting stimuli: flipping screen and playing audio
    2019-04-15 20:00:54,696 - EXP     - Expyfun: Audio stopped and reset.
    2019-04-15 20:00:54,696 - INFO    - Expyfun: Exiting
    2019-04-15 20:00:54,698 - EXP     - Expyfun: Audio stopped and reset.




|


.. code-block:: default

    # Author: Ross Maddox <rkmaddox@uw.edu>
    #
    # License: BSD (3-clause)

    import numpy as np

    from expyfun import ExperimentController, building_doc
    from expyfun.visual import Rectangle
    import expyfun.analyze as ea

    print(__doc__)


    with ExperimentController('LevelTest', full_screen=True, noise_db=-np.inf,
                              participant='s', session='0', output_dir=None,
                              suppress_resamp=True, check_rms=None,
                              stim_db=80, version='dev') as ec:
        tone = (0.01 * np.sqrt(2.) *
                np.sin(2 * np.pi * 1000. * np.arange(0, 10, 1. / ec.fs)))
        assert np.allclose(np.sqrt(np.mean(tone * tone)), 0.01)
        square = Rectangle(ec, (0, 0, 10, 10), units='deg', fill_color='r')
        cm = np.diff(ec._convert_units([[0, 5], [0, 5]], 'deg', 'pix'),
                     axis=-1)[0] / ec.dpi / 0.39370
        ec.load_buffer(tone)  # RMS == 0.01
        pressed = None
        screenshot = None
        while pressed != '8':  # enable a clean quit if required
            square.draw()
            ec.screen_text('Width: {} cm'.format(np.round(2 * cm, 1)), wrap=False)
            ec.screen_text('Output level: {} dB'.format(ec.stim_db), wrap=True)
            screenshot = ec.screenshot() if screenshot is None else screenshot
            t1 = ec.start_stimulus(start_of_trial=False)  # skip checks
            pressed = ec.wait_one_press(10)[0] if not building_doc else '8'
            ec.flip()
            ec.wait_one_press(0.5 if not building_doc else 0.)
            ec.stop()

    ea.plot_screen(screenshot)


.. rst-class:: sphx-glr-timing

   **Total running time of the script:** ( 0 minutes  0.437 seconds)


.. _sphx_glr_download_auto_examples_experiments_level_test.py:


.. only :: html

 .. container:: sphx-glr-footer
    :class: sphx-glr-footer-example



  .. container:: sphx-glr-download

     :download:`Download Python source code: level_test.py <level_test.py>`



  .. container:: sphx-glr-download

     :download:`Download Jupyter notebook: level_test.ipynb <level_test.ipynb>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_



.. _sphx_glr_auto_examples_experiments_keypress.py:


=============
Keypress demo
=============

This example demonstrates the different keypress-gathering techniques available
in the ExperimentController class.




.. image:: /auto_examples/experiments/images/sphx_glr_keypress_001.png
    :align: center


.. rst-class:: sphx-glr-script-out

 Out::

    exp_name: KeypressDemo
    date: 2017-11-27 19_39_11.851369
    file: /home/ubuntu/expyfun/examples/experiments/keypress.py
    participant: foo
    session: 001
    2017-11-27 19:39:11,851 - INFO    - Expyfun: Using version 2.0.0.dev0 (requested dev)
    2017-11-27 19:39:11,851 - INFO    - Expyfun: Setting up Pyglet audio
    2017-11-27 19:39:11,896 - INFO    - Expyfun: Setting up screen
    2017-11-27 19:39:11,907 - EXP     - Expyfun: Set screen visibility True
    2017-11-27 19:39:11,944 - INFO    - Expyfun: Initializing dummy triggering mode
    2017-11-27 19:39:11,947 - INFO    - Expyfun: Initialization complete
    2017-11-27 19:39:11,947 - EXP     - Expyfun: Participant: foo
    2017-11-27 19:39:11,947 - EXP     - Expyfun: Session: 001
    2017-11-27 19:39:15,654 - INFO    - Expyfun: Exiting
    2017-11-27 19:39:15,655 - EXP     - Expyfun: Audio stopped and reset.




|


.. code-block:: python

    # Author: Dan McCloy <drmccloy@uw.edu>
    #
    # License: BSD (3-clause)

    from expyfun import ExperimentController, building_doc
    import expyfun.analyze as ea

    print(__doc__)


    isi = 0.5
    wait_dur = 3.0 if not building_doc else 0.
    msg_dur = 3.0 if not building_doc else 0.

    with ExperimentController('KeypressDemo', screen_num=0,
                              window_size=[640, 480], full_screen=False,
                              stim_db=0, noise_db=0, output_dir=None,
                              participant='foo', session='001',
                              version='dev') as ec:
        ec.wait_secs(isi)

        ###############
        # screen_prompt
        pressed = ec.screen_prompt('press any key\n\nscreen_prompt('
                                   'max_wait={})'.format(wait_dur),
                                   max_wait=wait_dur, timestamp=True)
        ec.write_data_line('screen_prompt', pressed)
        if pressed[0] is None:
            message = 'no keys pressed'
        else:
            message = '{} pressed after {} secs'.format(pressed[0],
                                                        round(pressed[1], 4))
        ec.screen_prompt(message, msg_dur)
        ec.wait_secs(isi)

        ##################
        # wait_for_presses
        ec.screen_text('press some keys\n\nwait_for_presses(max_wait={})'
                       ''.format(wait_dur))
        screenshot = ec.screenshot()
        ec.flip()
        pressed = ec.wait_for_presses(wait_dur)
        ec.write_data_line('wait_for_presses', pressed)
        if not len(pressed):
            message = 'no keys pressed'
        else:
            message = ['{} pressed after {} secs\n'
                       ''.format(key, round(time, 4)) for key, time in pressed]
            message = ''.join(message)
        ec.screen_prompt(message, msg_dur)
        ec.wait_secs(isi)

        ############################################
        # wait_for_presses, relative to master clock
        ec.screen_text('press some keys\n\nwait_for_presses(max_wait={}, '
                       'relative_to=0.0)'.format(wait_dur))
        ec.flip()
        pressed = ec.wait_for_presses(wait_dur, relative_to=0.0)
        ec.write_data_line('wait_for_presses relative_to 0.0', pressed)
        if not len(pressed):
            message = 'no keys pressed'
        else:
            message = ['{} pressed at {} secs\n'
                       ''.format(key, round(time, 4)) for key, time in pressed]
            message = ''.join(message)
        ec.screen_prompt(message, msg_dur)
        ec.wait_secs(isi)

        ##########################################
        # listen_presses / wait_secs / get_presses
        ec.screen_text('press some keys\n\nlisten_presses()\nwait_secs({0})'
                       '\nget_presses()'.format(wait_dur))
        ec.flip()
        ec.listen_presses()
        ec.wait_secs(wait_dur)
        pressed = ec.get_presses()  # relative_to=0.0
        ec.write_data_line('listen / wait / get_presses', pressed)
        if not len(pressed):
            message = 'no keys pressed'
        else:
            message = ['{} pressed after {} secs\n'
                       ''.format(key, round(time, 4)) for key, time in pressed]
            message = ''.join(message)
        ec.screen_prompt(message, msg_dur)
        ec.wait_secs(isi)

        ####################################################################
        # listen_presses / wait_secs / get_presses, relative to master clock
        ec.screen_text('press a few keys\n\nlisten_presses()'
                       '\nwait_secs({0})\nget_presses(relative_to=0.0)'
                       ''.format(wait_dur))
        ec.flip()
        ec.listen_presses()
        ec.wait_secs(wait_dur)
        pressed = ec.get_presses(relative_to=0.0)
        ec.write_data_line('listen / wait / get_presses relative_to 0.0', pressed)
        if not len(pressed):
            message = 'no keys pressed'
        else:
            message = ['{} pressed at {} secs\n'
                       ''.format(key, round(time, 4)) for key, time in pressed]
            message = ''.join(message)
        ec.screen_prompt(message, msg_dur)
        ec.wait_secs(isi)

        ###########################################
        # listen_presses / while loop / get_presses
        disp_time = wait_dur
        countdown = ec.current_time + disp_time
        ec.call_on_next_flip(ec.listen_presses)
        ec.screen_text('press some keys\n\nlisten_presses()'
                       '\nwhile loop {}\nget_presses()'.format(disp_time))
        ec.flip()
        while ec.current_time < countdown:
            cur_time = round(countdown - ec.current_time, 1)
            if cur_time != disp_time:
                disp_time = cur_time
                # redraw text with updated disp_time
                ec.screen_text('press some keys\n\nlisten_presses() '
                               '\nwhile loop {}\nget_presses()'.format(disp_time))
                ec.flip()
        pressed = ec.get_presses()
        ec.write_data_line('listen / while / get_presses', pressed)
        if not len(pressed):
            message = 'no keys pressed'
        else:
            message = ['{} pressed after {} secs\n'
                       ''.format(key, round(time, 4)) for key, time in pressed]
            message = ''.join(message)
        ec.screen_prompt(message, msg_dur)
        ec.wait_secs(isi)

        #####################################################################
        # listen_presses / while loop / get_presses, relative to master clock
        disp_time = wait_dur
        countdown = ec.current_time + disp_time
        ec.call_on_next_flip(ec.listen_presses)
        ec.screen_text('press some keys\n\nlisten_presses()\nwhile loop '
                       '{}\nget_presses(relative_to=0.0)'.format(disp_time))
        ec.flip()
        while ec.current_time < countdown:
            cur_time = round(countdown - ec.current_time, 1)
            if cur_time != disp_time:
                disp_time = cur_time
                # redraw text with updated disp_time
                ec.screen_text('press some keys\n\nlisten_presses()\nwhile '
                               'loop {}\nget_presses(relative_to=0.0)'
                               ''.format(disp_time))
                ec.flip()
        pressed = ec.get_presses(relative_to=0.0)
        ec.write_data_line('listen / while / get_presses relative_to 0.0', pressed)
        if not len(pressed):
            message = 'no keys pressed'
        else:
            message = ['{} pressed at {} secs\n'
                       ''.format(key, round(time, 4)) for key, time in pressed]
            message = ''.join(message)
        ec.screen_prompt(message, msg_dur)

    ea.plot_screen(screenshot)

**Total running time of the script:** ( 0 minutes  3.860 seconds)



.. only :: html

 .. container:: sphx-glr-footer


  .. container:: sphx-glr-download

     :download:`Download Python source code: keypress.py <keypress.py>`



  .. container:: sphx-glr-download

     :download:`Download Jupyter notebook: keypress.ipynb <keypress.ipynb>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.readthedocs.io>`_
